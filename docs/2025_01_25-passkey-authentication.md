# ãƒ‘ã‚¹ã‚­ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

## æ¦‚è¦

å¾“æ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰+2FAèªè¨¼ã‹ã‚‰ã€ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆWebAuthnï¼‰ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã¸ç§»è¡Œã™ã‚‹ã€‚

## ç›®çš„

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š**: ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è€æ€§ã€ç”Ÿä½“èªè¨¼ã«ã‚ˆã‚‹å¤šè¦ç´ èªè¨¼
- **UXæ”¹å–„**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ä¸è¦ã€2FAãƒ¡ãƒ¼ãƒ«å¾…ã¡ä¸è¦
- **ç·Šæ€¥æ™‚å¯¾å¿œ**: ç”Ÿä½“èªè¨¼ã§å³åº§ã«ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½

## èªè¨¼æ–¹å¼

### ãƒ¡ã‚¤ãƒ³èªè¨¼: ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆWebAuthnï¼‰
- Touch ID / Face ID / Windows Hello
- ãƒ‡ãƒã‚¤ã‚¹å†…è”µã®ç”Ÿä½“èªè¨¼ã‚»ãƒ³ã‚µãƒ¼ä½¿ç”¨
- æŒ‡ç´‹ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰å‡ºãªã„ï¼ˆSecure Enclave/TPMä¿è­·ï¼‰

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èªè¨¼: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- ãƒ‘ã‚¹ã‚­ãƒ¼ãŒä½¿ãˆãªã„ç’°å¢ƒç”¨ï¼ˆå¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ç­‰ï¼‰
- æ—¢å­˜ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’ç¶­æŒ

### 2FAå»ƒæ­¢
- ãƒ‘ã‚¹ã‚­ãƒ¼è‡ªä½“ãŒå¤šè¦ç´ èªè¨¼ï¼ˆæ‰€æœ‰+ç”Ÿä½“ï¼‰
- OTPãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’å»ƒæ­¢

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### Passkeyãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ä½œæˆï¼‰

```prisma
model Passkey {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // WebAuthn Credentialæƒ…å ±
  credentialId      Bytes     @unique @map("credential_id")
  publicKey         Bytes     @map("public_key")
  counter           BigInt    @default(0)

  // ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
  deviceName        String?   @map("device_name")
  transports        String[]  @default([]) // ["usb", "nfc", "ble", "internal"]

  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  createdAt         DateTime  @default(now()) @map("created_at")
  lastUsedAt        DateTime? @map("last_used_at")

  @@index([userId])
  @@map("passkeys")
}
```

### WebAuthnChallengeãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ä½œæˆï¼‰

```prisma
model WebAuthnChallenge {
  id         String   @id @default(uuid())
  userId     String?  @map("user_id") // ç™»éŒ²æ™‚ã¯nullã€ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯è¨­å®š
  challenge  String   @unique
  type       String   // "registration" | "authentication"
  expiresAt  DateTime @map("expires_at")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@index([expiresAt])
  @@map("webauthn_challenges")
}
```

### Userãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¤‰æ›´ï¼‰

```prisma
model User {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String?   @map("password_hash")

  // å‰Šé™¤ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  // twoFactorEnabled Boolean @default(false) @map("two_factor_enabled")

  // æ–°è¦ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  passkeys      Passkey[]

  // ãã®ä»–æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  // ...
}
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- `@simplewebauthn/server@10.0.0` - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰WebAuthnå‡¦ç†
- `@simplewebauthn/browser@10.0.0` - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰WebAuthnå‡¦ç†

### ãƒ–ãƒ©ã‚¦ã‚¶è¦ä»¶
- Chrome 67+
- Safari 13+
- Firefox 60+
- Edge 18+

## APIè¨­è¨ˆ

### 1. ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²

#### POST `/api/auth/passkey/registration-options`
**ç›®çš„**: ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ç”¨ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "userId": "uuid"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "options": {
    "challenge": "base64-string",
    "rp": {
      "name": "å®‰å¦ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ",
      "id": "anpikakunin.xyz"
    },
    "user": {
      "id": "base64-user-id",
      "name": "user@example.com",
      "displayName": "user@example.com"
    },
    "pubKeyCredParams": [...],
    "timeout": 60000,
    "authenticatorSelection": {
      "residentKey": "preferred",
      "userVerification": "preferred"
    }
  }
}
```

#### POST `/api/auth/passkey/register`
**ç›®çš„**: ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ã®æ¤œè¨¼ãƒ»ä¿å­˜

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "userId": "uuid",
  "credential": {
    "id": "credential-id",
    "rawId": "base64-raw-id",
    "response": {
      "attestationObject": "base64-string",
      "clientDataJSON": "base64-string"
    },
    "type": "public-key"
  },
  "deviceName": "MacBook Pro" // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "passkeyId": "uuid"
}
```

### 2. ãƒ‘ã‚¹ã‚­ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³

#### POST `/api/auth/passkey/authentication-options`
**ç›®çš„**: ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "email": "user@example.com"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "options": {
    "challenge": "base64-string",
    "timeout": 60000,
    "rpId": "anpikakunin.xyz",
    "allowCredentials": [
      {
        "id": "base64-credential-id",
        "type": "public-key",
        "transports": ["internal"]
      }
    ],
    "userVerification": "preferred"
  }
}
```

#### POST `/api/auth/passkey/authenticate`
**ç›®çš„**: ãƒ‘ã‚¹ã‚­ãƒ¼èªè¨¼ã®æ¤œè¨¼ãƒ»ãƒ­ã‚°ã‚¤ãƒ³

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "email": "user@example.com",
  "credential": {
    "id": "credential-id",
    "rawId": "base64-raw-id",
    "response": {
      "authenticatorData": "base64-string",
      "clientDataJSON": "base64-string",
      "signature": "base64-string",
      "userHandle": "base64-string"
    },
    "type": "public-key"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "userId": "uuid",
  "sessionToken": "token"
}
```
+ Set-Cookie: session_token

### 3. ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²

#### POST `/api/auth/passkey/reset-request`
**ç›®çš„**: ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "email": "user@example.com"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "message": "ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã—ã¾ã—ãŸ"
}
```

**ãƒ¡ãƒ¼ãƒ«å†…å®¹**:
```
ä»¶å: ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²ã®ã”æ¡ˆå†…

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’å†ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚
ã“ã®ãƒªãƒ³ã‚¯ã¯24æ™‚é–“æœ‰åŠ¹ã§ã™ã€‚

https://anpikakunin.xyz/passkey-reset?token=xxxxx
```

#### POST `/api/auth/passkey/reset`
**ç›®çš„**: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼å¾Œã€ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "token": "reset-token",
  "credential": { ... }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’å†ç™»éŒ²ã—ã¾ã—ãŸ"
}
```

### 4. ãƒ‘ã‚¹ã‚­ãƒ¼ç®¡ç†

#### GET `/api/auth/passkey/list`
**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²æ¸ˆã¿ãƒ‘ã‚¹ã‚­ãƒ¼ä¸€è¦§å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "passkeys": [
    {
      "id": "uuid",
      "deviceName": "MacBook Pro",
      "createdAt": "2025-01-25T10:00:00Z",
      "lastUsedAt": "2025-01-25T12:00:00Z"
    }
  ]
}
```

#### DELETE `/api/auth/passkey/:id`
**ç›®çš„**: ãƒ‘ã‚¹ã‚­ãƒ¼å‰Šé™¤

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
}
```

## ãƒ•ãƒ­ãƒ¼å›³

### æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
   â†“
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
   â†“
3. ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ï¼ˆå¿…é ˆï¼‰
   â”œâ”€ POST /api/auth/passkey/registration-options
   â”œâ”€ ãƒ–ãƒ©ã‚¦ã‚¶ã§WebAuthn APIå‘¼ã³å‡ºã—
   â”œâ”€ ç”Ÿä½“èªè¨¼ï¼ˆTouch IDç­‰ï¼‰
   â””â”€ POST /api/auth/passkey/register
   â†“
4. ç™»éŒ²å®Œäº†ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
```

### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
   â†“
2. èªè¨¼æ–¹å¼é¸æŠ
   â”œâ”€ ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆæ¨å¥¨ï¼‰
   â”‚   â”œâ”€ POST /api/auth/passkey/authentication-options
   â”‚   â”œâ”€ ç”Ÿä½“èªè¨¼ï¼ˆTouch IDç­‰ï¼‰
   â”‚   â””â”€ POST /api/auth/passkey/authenticate â†’ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
   â”‚
   â””â”€ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
       â””â”€ POST /api/auth/login â†’ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ˆ2FAå»ƒæ­¢ï¼‰
```

### ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ã€Œãƒ‘ã‚¹ã‚­ãƒ¼ã‚’å†ç™»éŒ²ã€ã‚¯ãƒªãƒƒã‚¯
   â†“
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
   â†“
3. POST /api/auth/passkey/reset-request
   â†“
4. ãƒ¡ãƒ¼ãƒ«å—ä¿¡
   â†“
5. ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
6. ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ç”»é¢
   â”œâ”€ POST /api/auth/passkey/registration-options
   â”œâ”€ ç”Ÿä½“èªè¨¼
   â””â”€ POST /api/auth/passkey/reset
   â†“
7. å†ç™»éŒ²å®Œäº†
```

## UIè¨­è¨ˆ

### ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å®‰å¦ç¢ºèªã‚·ã‚¹ãƒ†ãƒ                â”‚
â”‚         ãƒ­ã‚°ã‚¤ãƒ³                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹                   â”‚
â”‚  [________________]              â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ” ãƒ‘ã‚¹ã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  ã¾ãŸã¯                          â”‚
â”‚                                 â”‚
â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰                       â”‚
â”‚  [________________]              â”‚
â”‚                                 â”‚
â”‚  [ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ ]         â”‚
â”‚                                 â”‚
â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã®æ–¹            â”‚
â”‚  ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’å†ç™»éŒ²                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ç”»é¢ï¼ˆæ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ‘ã‚¹ã‚­ãƒ¼ã®ç™»éŒ²                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€        â”‚
â”‚  ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚    â”‚
â”‚                                 â”‚
â”‚  ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’ä½¿ã†ã¨ï¼š              â”‚
â”‚  âœ“ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ä¸è¦            â”‚
â”‚  âœ“ ç”Ÿä½“èªè¨¼ã§å³åº§ã«ãƒ­ã‚°ã‚¤ãƒ³      â”‚
â”‚  âœ“ ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è©æ¬ºã«å¼·ã„        â”‚
â”‚                                 â”‚
â”‚  ãƒ‡ãƒã‚¤ã‚¹åï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰         â”‚
â”‚  [MacBook Pro__]                â”‚
â”‚                                 â”‚
â”‚  [ ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’ç™»éŒ² ]               â”‚
â”‚                                 â”‚
â”‚  â€» Touch ID/Face IDç­‰ã§         â”‚
â”‚    èªè¨¼ã—ã¾ã™                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‘ã‚¹ã‚­ãƒ¼ç®¡ç†ç”»é¢ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ‘ã‚¹ã‚­ãƒ¼ç®¡ç†                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ç™»éŒ²æ¸ˆã¿ãƒ‘ã‚¹ã‚­ãƒ¼                 â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ’» MacBook Pro            â”‚  â”‚
â”‚  â”‚ ç™»éŒ²: 2025/01/20          â”‚  â”‚
â”‚  â”‚ æœ€çµ‚ä½¿ç”¨: 2025/01/25      â”‚  â”‚
â”‚  â”‚              [ å‰Šé™¤ ]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“± iPhone 15              â”‚  â”‚
â”‚  â”‚ ç™»éŒ²: 2025/01/22          â”‚  â”‚
â”‚  â”‚ æœ€çµ‚ä½¿ç”¨: 2025/01/24      â”‚  â”‚
â”‚  â”‚              [ å‰Šé™¤ ]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  [ + æ–°ã—ã„ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’è¿½åŠ  ]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®Ÿè£…ã®å„ªå…ˆé †ä½

### Phase 1: åŸºæœ¬å®Ÿè£…
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°
2. WebAuthnãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²APIå®Ÿè£…
4. ãƒ‘ã‚¹ã‚­ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³APIå®Ÿè£…

### Phase 2: UIå®Ÿè£…
5. æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã«ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²è¿½åŠ 
6. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒ‘ã‚¹ã‚­ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³è¿½åŠ 

### Phase 3: ç®¡ç†æ©Ÿèƒ½
7. ãƒ‘ã‚¹ã‚­ãƒ¼ç®¡ç†ç”»é¢å®Ÿè£…
8. ãƒ‘ã‚¹ã‚­ãƒ¼å†ç™»éŒ²æ©Ÿèƒ½å®Ÿè£…

### Phase 4: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
9. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ä¿ƒé€²
10. 2FAé–¢é€£ã‚³ãƒ¼ãƒ‰å‰Šé™¤

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç®¡ç†
- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¯1å›é™ã‚Šä½¿ç”¨
- æœ‰åŠ¹æœŸé™: 60ç§’
- ä½¿ç”¨å¾Œã¯å³åº§ã«å‰Šé™¤

### RP IDè¨­å®š
- é–‹ç™ºç’°å¢ƒ: `localhost`
- æœ¬ç•ªç’°å¢ƒ: `anpikakunin.xyz`

### Originæ¤œè¨¼
- WebAuthnã¯è‡ªå‹•çš„ã«Originã‚’æ¤œè¨¼
- ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚µã‚¤ãƒˆã§ã¯å‹•ä½œã—ãªã„

### Counteræ¤œè¨¼
- ãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒé˜²æ­¢
- counterãŒæ¸›å°‘ã—ãŸã‚‰æ‹’å¦

## æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç§»è¡Œ

### ç§»è¡Œæˆ¦ç•¥
1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã¯æ®‹ã™ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
2. ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ã‚’ä¿ƒã™ãƒãƒŠãƒ¼è¡¨ç¤º
3. ã€Œå¾Œã§ç™»éŒ²ã€ã‚‚å¯èƒ½ï¼ˆå¼·åˆ¶ã—ãªã„ï¼‰
4. ä¸€å®šæœŸé–“å¾Œã€ãƒ‘ã‚¹ã‚­ãƒ¼æœªç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

### ç§»è¡ŒæœŸé–“
- 3ãƒ¶æœˆé–“ã¯ä¸¡æ–¹ã‚µãƒãƒ¼ãƒˆ
- ãã®å¾Œã€ãƒ‘ã‚¹ã‚­ãƒ¼ã‚’æ¨å¥¨ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚æ®‹ã™ï¼‰

## ç’°å¢ƒå¤‰æ•°

```bash
# WebAuthnè¨­å®š
NEXT_PUBLIC_RP_NAME=å®‰å¦ç¢ºèªã‚·ã‚¹ãƒ†ãƒ 
NEXT_PUBLIC_RP_ID=anpikakunin.xyz  # æœ¬ç•ªç’°å¢ƒ
# NEXT_PUBLIC_RP_ID=localhost  # é–‹ç™ºç’°å¢ƒ

# Origin
NEXT_PUBLIC_ORIGIN=https://anpikakunin.xyz  # æœ¬ç•ªç’°å¢ƒ
# NEXT_PUBLIC_ORIGIN=http://localhost:3000  # é–‹ç™ºç’°å¢ƒ
```

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### å˜ä½“ãƒ†ã‚¹ãƒˆ
- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç”Ÿæˆãƒ»æ¤œè¨¼
- å…¬é–‹éµæ¤œè¨¼
- Counteræ¤œè¨¼

### çµ±åˆãƒ†ã‚¹ãƒˆ
- ç™»éŒ²ãƒ•ãƒ­ãƒ¼
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
- å†ç™»éŒ²ãƒ•ãƒ­ãƒ¼

### E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰
- å„ç¨®ãƒ‡ãƒã‚¤ã‚¹ã§ã®å‹•ä½œç¢ºèª
  - MacBook (Touch ID)
  - iPhone (Face ID)
  - Windows (Windows Hello)
  - Android (æŒ‡ç´‹èªè¨¼)

## å‚è€ƒè³‡æ–™

- [WebAuthn Specification](https://www.w3.org/TR/webauthn/)
- [SimpleWebAuthn Documentation](https://simplewebauthn.dev/)
- [MDN Web Authentication API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API)
