generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EarthquakeEventLog {
  id          Int      @id @default(autoincrement())
  eventId     String   @map("event_id")
  payloadHash String   @map("payload_hash")
  source      String
  payload     Json
  fetchedAt   DateTime @default(now()) @map("fetched_at")

  @@map("earthquake_event_logs")
  @@unique([eventId, payloadHash], map: "earthquake_event_logs_event_id_payload_hash_key")
  @@index([eventId], map: "idx_earthquake_event_logs_event_id")
}

model SlackWorkspace {
  id                 String                     @id @default(uuid())
  workspaceId        String                     @unique @map("workspace_id")
  name               String
  botTokenCiphertext Bytes                      @map("bot_token_ciphertext")
  botTokenIv         Bytes                      @map("bot_token_iv")
  botTokenTag        Bytes                      @map("bot_token_tag")
  isEnabled          Boolean                    @default(true) @map("is_enabled")
  createdAt          DateTime                   @default(now()) @map("created_at")
  updatedAt          DateTime                   @updatedAt @map("updated_at")
  notificationSettings SlackNotificationSetting?

  @@map("slack_workspaces")
  @@index([workspaceId], map: "idx_slack_workspaces_workspace_id")
}

model SlackNotificationSetting {
  id                  String          @id @default(uuid())
  workspaceRef        String          @unique @map("workspace_ref")
  workspace           SlackWorkspace  @relation(fields: [workspaceRef], references: [id], onDelete: Cascade)
  minIntensity        String?         @map("min_intensity")
  targetPrefectures   String[]        @map("target_prefectures")
  notificationChannels Json?          @map("notification_channels")
  extraSettings       Json?           @map("extra_settings")
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @updatedAt @map("updated_at")

  @@map("slack_notification_settings")
}
