# プロジェクト改善記録

## 過去の試行錯誤

### IndexedDB → PostgreSQL 移行 (2025-10-07)
- **問題**: ブラウザリロード時にイベント履歴が消える
- **試行1**: IndexedDBのみで永続化 → ブラウザキャッシュクリアで全消失
- **試行2**: LocalStorageに保存 → 容量制限5MBで不足
- **最終解決**: PostgreSQLで永続化、IndexedDBは短期キャッシュ用
- **学び**: クライアントストレージは補助的に使い、重要データはサーバー側で管理

### Slackトークン平文保存問題 (初期実装)
- **問題**: DBダンプ時にトークンが露出
- **失敗**: 環境変数で1つのトークンを管理 → マルチワークスペース非対応
- **改善**: AES-256-GCM暗号化でDB保存、復号は使用時のみ
- **学び**: 機密情報は必ず暗号化、暗号化キーは環境変数で管理

### WebSocket切断頻発問題 (開発中)
- **原因**: DMData.jp側のタイムアウト設定
- **対策**: Ping/Pong実装、30秒ごとにハートビート送信
- **結果**: 安定性向上、切断頻度が1/10に減少

## 改善プロセス

### Phase 1: MVP実装 (完了)
- リアルタイムモニタリング画面
- WebSocket接続
- IndexedDBキャッシュ

### Phase 2: データ永続化 (完了)
- PostgreSQL導入
- Prisma ORM統合
- 暗号化実装

### Phase 3: 通知機能 (進行中)
- [ ] 通知条件フィルタリング
- [ ] Slack自動通知
- [ ] 設定画面UI

### Phase 4: 運用改善 (未着手)
- [ ] ログ監視・アラート
- [ ] パフォーマンス最適化
- [ ] 多言語対応

## 今後の課題

### パフォーマンス
- PostgreSQLクエリの最適化（N+1問題の回避）
- IndexedDBのクリーンアップ処理改善

### スケーラビリティ
- 複数ワークスペースの並列通知処理
- WebSocket接続のプール管理

### 運用
- エラー通知の仕組み（Slack/メール）
- デプロイ自動化（CI/CD）
